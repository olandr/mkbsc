#!/usr/bin/env python3

from mkbsc import MultiplayerGame, iterate_until_isomorphic, \
                  export, to_string, from_string, to_file, from_file

#states
L = ["start", "00", "01", "10", "11", "win", "lose"]
#initial state
L0 = "start"
#action alphabet
Sigma = (("a0", "at", "-1", "b0", "bt"), ("a0", "at", "-1", "b0", "bt"))
#action labeled transitions
Delta = [
    ("start", ("-1", "-1"),    "lose"),
    ("start", ("-1", "a0"),    "00"),
    ("start", ("-1", "at"),    "10"),
    ("start", ("-1", "b0"),    "00"),
    ("start", ("-1", "bt"),    "01"),

    ("start", ("a0", "-1"),    "00"),
    ("start", ("a0", "a0"),    "00"),
    ("start", ("a0", "at"),    "10"),
    ("start", ("a0", "b0"),    "00"),
    ("start", ("a0", "bt"),    "01"),

    ("start", ("at", "-1"),    "10"),
    ("start", ("at", "a0"),    "10"),
    ("start", ("at", "at"),    "10"),
    ("start", ("at", "b0"),    "10"),
    ("start", ("at", "bt"),    "11"),

    ("start", ("b0", "-1"),    "00"),
    ("start", ("b0", "a0"),    "00"),
    ("start", ("b0", "at"),    "10"),
    ("start", ("b0", "b0"),    "00"),
    ("start", ("b0", "bt"),    "01"),

    ("start", ("bt", "-1"),    "01"),
    ("start", ("bt", "a0"),    "01"),
    ("start", ("bt", "at"),    "11"),
    ("start", ("bt", "b0"),    "01"),
    ("start", ("bt", "bt"),    "01"),


    ("00",    ("-1", "-1"),    "lose"),
    ("00",    ("-1", "a0"),    "00"),
    ("00",    ("-1", "at"),    "10"),
    ("00",    ("-1", "b0"),    "00"),
    ("00",    ("-1", "bt"),    "01"),

    ("00",    ("a0", "-1"),    "00"),
    ("00",    ("a0", "a0"),    "00"),
    ("00",    ("a0", "at"),    "10"),
    ("00",    ("a0", "b0"),    "00"),
    ("00",    ("a0", "bt"),    "01"),

    ("00",    ("at", "-1"),    "10"),
    ("00",    ("at", "a0"),    "10"),
    ("00",    ("at", "at"),    "10"),
    ("00",    ("at", "b0"),    "10"),
    ("00",    ("at", "bt"),    "11"),

    ("00",    ("b0", "-1"),    "00"),
    ("00",    ("b0", "a0"),    "00"),
    ("00",    ("b0", "at"),    "10"),
    ("00",    ("b0", "b0"),    "00"),
    ("00",    ("b0", "bt"),    "01"),

    ("00",    ("bt", "-1"),    "01"),
    ("00",    ("bt", "a0"),    "01"),
    ("00",    ("bt", "at"),    "11"),
    ("00",    ("bt", "b0"),    "01"),
    ("00",    ("bt", "bt"),    "01"),


    ("01",    ("-1", "-1"),    "lose"),
    ("01",    ("-1", "a0"),    "01"),
    ("01",    ("-1", "at"),    "11"),
    ("01",    ("-1", "b0"),    "00"),
    ("01",    ("-1", "bt"),    "00"),

    ("01",    ("a0", "-1"),    "01"),
    ("01",    ("a0", "a0"),    "01"),
    ("01",    ("a0", "at"),    "11"),
    ("01",    ("a0", "b0"),    "00"),
    ("01",    ("a0", "bt"),    "00"),

    ("01",    ("at", "-1"),    "11"),
    ("01",    ("at", "a0"),    "11"),
    ("01",    ("at", "at"),    "11"),
    ("01",    ("at", "b0"),    "10"),
    ("01",    ("at", "bt"),    "10"),

    ("01",    ("b0", "-1"),    "00"),
    ("01",    ("b0", "a0"),    "00"),
    ("01",    ("b0", "at"),    "10"),
    ("01",    ("b0", "b0"),    "00"),
    ("01",    ("b0", "bt"),    "00"),

    ("01",    ("bt", "-1"),    "00"),
    ("01",    ("bt", "a0"),    "00"),
    ("01",    ("bt", "at"),    "10"),
    ("01",    ("bt", "b0"),    "00"),
    ("01",    ("bt", "bt"),    "00"),


    ("10",    ("-1", "-1"),    "lose"),
    ("10",    ("-1", "a0"),    "00"),
    ("10",    ("-1", "at"),    "10"),
    ("10",    ("-1", "b0"),    "10"),
    ("10",    ("-1", "bt"),    "11"),

    ("10",    ("a0", "-1"),    "00"),
    ("10",    ("a0", "a0"),    "00"),
    ("10",    ("a0", "at"),    "00"),
    ("10",    ("a0", "b0"),    "00"),
    ("10",    ("a0", "bt"),    "01"),

    ("10",    ("at", "-1"),    "00"),
    ("10",    ("at", "a0"),    "00"),
    ("10",    ("at", "at"),    "00"),
    ("10",    ("at", "b0"),    "00"),
    ("10",    ("at", "bt"),    "01"),

    ("10",    ("b0", "-1"),    "10"),
    ("10",    ("b0", "a0"),    "00"),
    ("10",    ("b0", "at"),    "00"),
    ("10",    ("b0", "b0"),    "10"),
    ("10",    ("b0", "bt"),    "11"),

    ("10",    ("bt", "-1"),    "11"),
    ("10",    ("bt", "a0"),    "01"),
    ("10",    ("bt", "at"),    "01"),
    ("10",    ("bt", "b0"),    "01"),
    ("10",    ("bt", "bt"),    "01"),


    ("11",    ("-1", "-1"),    "win"),
    ("11",    ("-1", "a0"),    "01"),
    ("11",    ("-1", "at"),    "01"),
    ("11",    ("-1", "b0"),    "10"),
    ("11",    ("-1", "bt"),    "10"),

    ("11",    ("a0", "-1"),    "01"),
    ("11",    ("a0", "a0"),    "01"),
    ("11",    ("a0", "at"),    "01"),
    ("11",    ("a0", "b0"),    "00"),
    ("11",    ("a0", "bt"),    "00"),

    ("11",    ("at", "-1"),    "01"),
    ("11",    ("at", "a0"),    "01"),
    ("11",    ("at", "at"),    "01"),
    ("11",    ("at", "b0"),    "00"),
    ("11",    ("at", "bt"),    "00"),

    ("11",    ("b0", "-1"),    "10"),
    ("11",    ("b0", "a0"),    "00"),
    ("11",    ("b0", "at"),    "00"),
    ("11",    ("b0", "b0"),    "10"),
    ("11",    ("b0", "bt"),    "10"),

    ("11",    ("bt", "-1"),    "10"),
    ("11",    ("bt", "a0"),    "00"),
    ("11",    ("bt", "at"),    "00"),
    ("11",    ("bt", "b0"),    "10"),
    ("11",    ("bt", "bt"),    "10"),
]
#observation partitioning
Obs = [
    [["start"], ["00", "01", "10", "11"], ["win"], ["lose"]],
    [["start"], ["00", "01", "10", "11"], ["win"], ["lose"]]
]

#G is a MultiplayerGame-object, and so are GK and GK0
G = MultiplayerGame.create(L, L0, Sigma, Delta, Obs)
export(G, "2_memory_G")

GK = G.KBSC()
export(GK, "2_memory_GK")

(log2, GK2, iso_type2) = iterate_until_isomorphic(G, limit=3, print_size=False, verbose=True)
export(GK2, "2_memory_GK2")
print(log2, GK2, iso_type2)
